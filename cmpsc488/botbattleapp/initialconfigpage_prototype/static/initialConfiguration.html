<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css"
	href="static/css/initialConfiguration.css">
<title>BOTBATTLE!!!</title>
</head>
<body class="centered">
	<p id="message"></p>
	<form id="initConfigForm" enctype="multipart/form-data" method="POST">
		<!-- <b>Upload:</b> <input type="file" required name="fileInput"> -->

		<div class="form-group">
			<div class="form-item">
				<label for="databaseHost">
				  Database Host
				  <span class="form-required" title="This field is required."> * </span>
				</label>
				<input type="text" maxlength="60" size="30" value="127.0.0.1" placeholder="e.g. 127.0.0.1 or localhost"  required name="databaseHost"></input>
			</div>
      <div class="form-item">
        <label for="databasePort">
          Database Port
          <span class="form-required" title="This field is required."> * </span>
        </label>
        <input name="databasePort" type="text" maxlength="5" size="10" value="27017" required></input>
      </div>
      <div class="form-item">
        <label for="databaseName">
          Database Name
          <span class="form-required" title="This field is required."> * </span>
        </label>
        <input name="databaseName" type="text" maxlength="60" size="10" value="testDB" placeholder="botbattle" required></input>
      </div>
      <div class="form-item">
        <label for="databaseUserName">
          Database Name
          <span class="form-required" title="This field is required."> * </span>
        </label>
        <input name="databaseUserName" type="text" maxlength="60" size="10" value="testUser" placeholder="testUser" required></input>
      </div>
      <div class="form-item">
        <label for="databasePassword">
          Database Password
          <span class="form-required" title="This field is required."> * </span>
        </label>
        <input name="databasePassword" type="password" maxlength="60" size="10" value="testPass" required></input>
      </div>
      
    </div>

	  <input id="submit" type="submit" value="Submit">

	</form>
  <p>Progress: 
	   <progress id="progress" value="0" max="100"> </progress>
	</p>
</body>


<script src="/socket.io/socket.io.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>

<script>
var socket = io.connect();
socket.on('progress_update', function(progress){
   /*
   var old = $('#progress').val();
   old += 10;
   */
   $('#progress').val(progress);
});
/*
socket.on('closing', function(err,data){
     setInterval(function (){ location.reload(); }, 5000);
});
*/
socket.on('setup_complete', function(data){
     var count = 5;
     setInterval(function (){ 
      
      document.getElementById('message').innerHTML = "Configuration Successful!<br>The page will reload in " + count + " seconds and take you to the Public Portal";
      count--;
      if (count == 0)
      {
        location.reload();
      }
     }, 1000);
});

socket.on('setup_error', function(err){
      document.getElementById('message').innerHTML = "There was an error during configuration...<br>" + err;
});


var form = document.getElementById("initConfigForm");
form.addEventListener('submit', function(ev) {
        var req = new XMLHttpRequest();
        var theForm = new FormData(form);
        req.open("POST", "processInitialConfiguration", true);
        req.send(theForm);
        
        req.onload = function(event) {
          if (req.status == 200) {
             console.log("onload");
          } else {
             console.log("error onload");
          }
        };
  ev.preventDefault();
}, false);

</script>

</html>